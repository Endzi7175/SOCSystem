
template header

rule
ruleNum

package com.sbnz.SIEMCenter2;
import com.sbnz.SIEMCenter2.model.LogEntry
import com.sbnz.SIEMCenter2.model.AlarmTriggered
import com.sbnz.SIEMCenter2.service.AlarmTriggeredService;
import java.util.ArrayList
global ArrayList<AlarmTriggered> alarms;
global AlarmTriggeredService alarmService;

template "alert"

rule "alert_@{ruleNum}"
when
     $l1 : LogEntry(@{rule})
      and
      Number(intValue >= @{count}) from accumulate(
          $l2: LogEntry(
              @{rule} and
              this meets[@{interval}] $l1
          ),
          count($l2)
     )
then
     System.out.println(l);
     alarmService.save(new AlarmTriggered(l.userId, @{alarmMessage}, -1));
end

end template
