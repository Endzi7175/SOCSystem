//created on: May 19, 2019
package sbnz.rules
import com.sbnz.SIEMCenter2.model.LogEntry
import com.sbnz.SIEMCenter2.model.AlarmTriggered
import java.util.ArrayList
global java.util.ArrayList<AlarmTriggered> alarms
rule "A stand alone rule"

   when
        l : LogEntry( userId == "1", myMsg : message )
    then
        System.out.println( myMsg );
        l.setMessage( "Goodbye cruel world" );
        

end
rule "Vise od 3 neuspesnih prijava od strane jednog korisnika"
    when
        $l1: LogEntry(message.equals("Neuspesna prijava"), $m: message, $id: userId)
        not (AlarmTriggered(customerId == $id))
        Number(intValue >= 2) from accumulate(
            $l2: LogEntry(
                this != $l1, 
                message == $m,
                userId == $id, 
                this meets[1h30m] $l1
            ),
            count($l2)
        )
        
    then
        System.out.println("Uspelooooo");
    	insert(new AlarmTriggered($id, "3 neuspela pokusaja prijave"));
end
rule "Pojava loga koji je tipa error log level = 1 kad je error"
    when
        LogEntry(logLevel == 1, $m: message, $id: userId)
        
        
    then
    	
    	alarms.add(new AlarmTriggered($id, "Greska u programu: " + $m));
    	insert(new AlarmTriggered($id, "Greska u programu: " + $m));
end



